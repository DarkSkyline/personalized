<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Validating fitted subgroup identification models — validate.subgroup • personalized</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Validating fitted subgroup identification models — validate.subgroup" />

<meta property="og:description" content="Validates subgroup treatment effects for fitted
 subgroup identification model class of Chen, et al (2017)" />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">personalized</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions and data</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Validating fitted subgroup identification models</h1>
    
    </div>

    
    <p>Validates subgroup treatment effects for fitted
 subgroup identification model class of Chen, et al (2017)</p>
    

    <pre class="usage"><span class='fu'>validate.subgroup</span>(<span class='no'>model</span>, <span class='kw'>B</span> <span class='kw'>=</span> <span class='fl'>50L</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"training_test_replication"</span>,
  <span class='st'>"boot_bias_correction"</span>), <span class='kw'>train.fraction</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>benefit.score.quantiles</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.1666667</span>, <span class='fl'>0.3333333</span>, <span class='fl'>0.5</span>, <span class='fl'>0.6666667</span>,
  <span class='fl'>0.8333333</span>), <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>fitted model object returned by <code><a href='fit.subgroup.html'>fit.subgroup()</a></code> function</p></td>
    </tr>
    <tr>
      <th>B</th>
      <td><p>integer. number of bootstrap replications or refitting replications.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>validation method. <code>"boot_bias_correction"</code> for the bootstrap
bias correction method of Harrell, et al (1996) or <code>"training_test_replication"</code>
for repeated training and test splitting of the data (<code>train.fraction</code> should be specified
for this option)</p></td>
    </tr>
    <tr>
      <th>train.fraction</th>
      <td><p>fraction (between 0 and 1) of samples to be used for training in
training/test replication. Only used for <code>method = "training_test_replication"</code></p></td>
    </tr>
    <tr>
      <th>benefit.score.quantiles</th>
      <td><p>a vector of quantiles (between 0 and 1) of the benefit score values
for which to return bootstrapped information about the subgroups. ie if one of the quantile values is 0.5, the
median value of the benefit scores will be used as a cutoff to determine subgroups and summary statistics
will be returned about these subgroups</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>Should the loop over replications be parallelized? If <code>FALSE</code>, then no, if <code>TRUE</code>, then yes.
If user sets <code>parallel = TRUE</code> and the fitted <code><a href='fit.subgroup.html'>fit.subgroup()</a></code> object uses the parallel version of
an internal model, say for <code>cv.glmnet()</code>, then the internal parallelization will be overridden so as
not to create a conflict of parallelism.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Chen, S., Tian, L., Cai, T. and Yu, M. (2017), A general statistical framework for subgroup identification
and comparative treatment scoring. Biometrics. doi:10.1111/biom.12676</p>
<p>Harrell, F. E., Lee, K. L., and Mark, D. B. (1996). Tutorial in biostatistics multivariable prognostic models: issues in developing models,
evaluating assumptions and adequacy, and measuring and reducing errors. Statistics in medicine, 15, 361-387.
doi:10.1002/(SICI)1097-0258(19960229)15:4&lt;361::AID-SIM168&gt;3.0.CO;2-4</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='fit.subgroup.html'>fit.subgroup</a></code> for function which fits subgroup identification models,
<code><a href='plot.html'>plot.subgroup_validated</a></code> for plotting of validation results, and
<code><a href='print.html'>print.subgroup_validated</a></code> for arguments for printing options for <code>validate.subgroup()</code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>library</span>(<span class='no'>personalized</span>)

<span class='fu'>set.seed</span>(<span class='fl'>123</span>)
<span class='no'>n.obs</span>  <span class='kw'>&lt;-</span> <span class='fl'>500</span>
<span class='no'>n.vars</span> <span class='kw'>&lt;-</span> <span class='fl'>20</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>rnorm</span>(<span class='no'>n.obs</span> * <span class='no'>n.vars</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>3</span>), <span class='no'>n.obs</span>, <span class='no'>n.vars</span>)


<span class='co'># simulate non-randomized treatment</span>
<span class='no'>xbetat</span>   <span class='kw'>&lt;-</span> <span class='fl'>0.5</span> + <span class='fl'>0.5</span> * <span class='no'>x</span>[,<span class='fl'>11</span>] - <span class='fl'>0.5</span> * <span class='no'>x</span>[,<span class='fl'>13</span>]
<span class='no'>trt.prob</span> <span class='kw'>&lt;-</span> <span class='fu'>exp</span>(<span class='no'>xbetat</span>) / (<span class='fl'>1</span> + <span class='fu'>exp</span>(<span class='no'>xbetat</span>))
<span class='no'>trt01</span>    <span class='kw'>&lt;-</span> <span class='fu'>rbinom</span>(<span class='no'>n.obs</span>, <span class='fl'>1</span>, <span class='kw'>prob</span> <span class='kw'>=</span> <span class='no'>trt.prob</span>)

<span class='no'>trt</span>      <span class='kw'>&lt;-</span> <span class='fl'>2</span> * <span class='no'>trt01</span> - <span class='fl'>1</span>

<span class='co'># simulate response</span>
<span class='no'>delta</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span> * (<span class='fl'>0.5</span> + <span class='no'>x</span>[,<span class='fl'>2</span>] - <span class='no'>x</span>[,<span class='fl'>3</span>] - <span class='no'>x</span>[,<span class='fl'>11</span>] + <span class='no'>x</span>[,<span class='fl'>1</span>] * <span class='no'>x</span>[,<span class='fl'>12</span>])
<span class='no'>xbeta</span> <span class='kw'>&lt;-</span> <span class='no'>x</span>[,<span class='fl'>1</span>] + <span class='no'>x</span>[,<span class='fl'>11</span>] - <span class='fl'>2</span> * <span class='no'>x</span>[,<span class='fl'>12</span>]^<span class='fl'>2</span> + <span class='no'>x</span>[,<span class='fl'>13</span>]
<span class='no'>xbeta</span> <span class='kw'>&lt;-</span> <span class='no'>xbeta</span> + <span class='no'>delta</span> * <span class='no'>trt</span>

<span class='co'># continuous outcomes</span>
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>drop</span>(<span class='no'>xbeta</span>) + <span class='fu'>rnorm</span>(<span class='no'>n.obs</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>2</span>)

<span class='co'># create function for fitting propensity score model</span>
<span class='no'>prop.func</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>, <span class='no'>trt</span>)
{
    <span class='co'># fit propensity score model</span>
    <span class='no'>propens.model</span> <span class='kw'>&lt;-</span> <span class='fu'>cv.glmnet</span>(<span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>trt</span>,
                               <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"binomial"</span>)
    <span class='no'>pi.x</span> <span class='kw'>&lt;-</span> <span class='fu'>predict</span>(<span class='no'>propens.model</span>, <span class='kw'>s</span> <span class='kw'>=</span> <span class='st'>"lambda.min"</span>,
                    <span class='kw'>newx</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"response"</span>)[,<span class='fl'>1</span>]
    <span class='no'>pi.x</span>
}

<span class='no'>subgrp.model</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='fit.subgroup.html'>fit.subgroup</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>x</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y</span>,
                             <span class='kw'>trt</span> <span class='kw'>=</span> <span class='no'>trt01</span>,
                             <span class='kw'>propensity.func</span> <span class='kw'>=</span> <span class='no'>prop.func</span>,
                             <span class='kw'>loss</span>   <span class='kw'>=</span> <span class='st'>"sq_loss_lasso"</span>,
                             <span class='kw'>nfolds</span> <span class='kw'>=</span> <span class='fl'>5</span>)    <span class='co'># option for cv.glmnet</span>

<span class='no'>subgrp.model</span>$<span class='no'>subgroup.trt.effects</span></div><div class='output co'>#&gt; $subgroup.effects
#&gt; 0 effect among recommended 0 1 effect among recommended 1 
#&gt;                     19.75833                     18.26168 
#&gt; 
#&gt; $avg.outcomes
#&gt;            Recommended 0 Recommended 1
#&gt; Received 0     -3.821617     -31.30368
#&gt; Received 1    -23.579944     -13.04201
#&gt; 
#&gt; $sample.sizes
#&gt;            Recommended 0 Recommended 1
#&gt; Received 0            50           170
#&gt; Received 1           159           121
#&gt; 
#&gt; $overall.subgroup.effect
#&gt; [1] 19.16871
#&gt; </div><div class='input'>
<span class='no'>x.test</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>rnorm</span>(<span class='fl'>10</span> * <span class='no'>n.obs</span> * <span class='no'>n.vars</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>3</span>), <span class='fl'>10</span> * <span class='no'>n.obs</span>, <span class='no'>n.vars</span>)


<span class='co'># simulate non-randomized treatment</span>
<span class='no'>xbetat.test</span>   <span class='kw'>&lt;-</span> <span class='fl'>0.5</span> + <span class='fl'>0.5</span> * <span class='no'>x.test</span>[,<span class='fl'>11</span>] - <span class='fl'>0.5</span> * <span class='no'>x.test</span>[,<span class='fl'>13</span>]
<span class='no'>trt.prob.test</span> <span class='kw'>&lt;-</span> <span class='fu'>exp</span>(<span class='no'>xbetat.test</span>) / (<span class='fl'>1</span> + <span class='fu'>exp</span>(<span class='no'>xbetat.test</span>))
<span class='no'>trt01.test</span>    <span class='kw'>&lt;-</span> <span class='fu'>rbinom</span>(<span class='fl'>10</span> * <span class='no'>n.obs</span>, <span class='fl'>1</span>, <span class='kw'>prob</span> <span class='kw'>=</span> <span class='no'>trt.prob.test</span>)

<span class='no'>trt.test</span>      <span class='kw'>&lt;-</span> <span class='fl'>2</span> * <span class='no'>trt01.test</span> - <span class='fl'>1</span>

<span class='co'># simulate response</span>
<span class='no'>delta.test</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span> * (<span class='fl'>0.5</span> + <span class='no'>x.test</span>[,<span class='fl'>2</span>] - <span class='no'>x.test</span>[,<span class='fl'>3</span>] - <span class='no'>x.test</span>[,<span class='fl'>11</span>] + <span class='no'>x.test</span>[,<span class='fl'>1</span>] * <span class='no'>x.test</span>[,<span class='fl'>12</span>])
<span class='no'>xbeta.test</span> <span class='kw'>&lt;-</span> <span class='no'>x.test</span>[,<span class='fl'>1</span>] + <span class='no'>x.test</span>[,<span class='fl'>11</span>] - <span class='fl'>2</span> * <span class='no'>x.test</span>[,<span class='fl'>12</span>]^<span class='fl'>2</span> + <span class='no'>x.test</span>[,<span class='fl'>13</span>]
<span class='no'>xbeta.test</span> <span class='kw'>&lt;-</span> <span class='no'>xbeta.test</span> + <span class='no'>delta.test</span> * <span class='no'>trt.test</span>

<span class='no'>y.test</span> <span class='kw'>&lt;-</span> <span class='fu'>drop</span>(<span class='no'>xbeta.test</span>) + <span class='fu'>rnorm</span>(<span class='fl'>10</span> * <span class='no'>n.obs</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>2</span>)

<span class='no'>valmod</span> <span class='kw'>&lt;-</span> <span class='fu'>validate.subgroup</span>(<span class='no'>subgrp.model</span>, <span class='kw'>B</span> <span class='kw'>=</span> <span class='fl'>10</span>,
                            <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"training_test"</span>,
                            <span class='kw'>train.fraction</span> <span class='kw'>=</span> <span class='fl'>0.75</span>)
<span class='no'>valmod</span></div><div class='output co'>#&gt; family:  gaussian 
#&gt; loss:    sq_loss_lasso 
#&gt; method:  weighting 
#&gt; 
#&gt; validation method:  training_test_replication 
#&gt; iterations:  10 
#&gt; 
#&gt; Average Test Set Outcomes:
#&gt;                                Recommended 0                   Recommended 1
#&gt; Received 0 -14.9597 (SE = 11.1886, n = 13.7)  -21.4771 (SE = 7.7994, n = 43)
#&gt; Received 1    -21.5129 (SE = 3.6628, n = 37) -14.965 (SE = 4.2433, n = 31.3)
#&gt; 
#&gt;    0 effect among recommended 0    1 effect among recommended 1 
#&gt; 6.5532 (SE = 11.8404, n = 50.7) 6.5121 (SE = 10.2546, n = 74.3) 
#&gt; 
#&gt; Overall Subgroup Effect 
#&gt;    5.4065 (SE = 8.0859) </div><div class='input'>
<span class='fu'>print</span>(<span class='no'>valmod</span>, <span class='kw'>which.quant</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>4</span>, <span class='fl'>5</span>))</div><div class='output co'>#&gt; family:  gaussian 
#&gt; loss:    sq_loss_lasso 
#&gt; method:  weighting 
#&gt; 
#&gt; validation method:  training_test_replication 
#&gt; Cutoff:             Quant_67 
#&gt; iterations:         10 
#&gt; 
#&gt; Average Test Set Outcomes:
#&gt;                               Recommended 0                    Recommended 1
#&gt; Received 0 -14.0381 (SE = 7.9558, n = 29.5) -30.5683 (SE = 5.5557, n = 27.2)
#&gt; Received 1 -19.1725 (SE = 2.7345, n = 54.5) -16.1053 (SE = 8.1065, n = 13.8)
#&gt; 
#&gt;  0 effect among recommended 0  1 effect among recommended 1 
#&gt;   5.1344 (SE = 8.506, n = 84) 14.4631 (SE = 9.6631, n = 41) 
#&gt; 
#&gt; Overall Subgroup Effect 
#&gt;    9.5669 (SE = 5.7354) 
#&gt; 
#&gt; &lt;===============================================&gt;
#&gt; 
#&gt; family:  gaussian 
#&gt; loss:    sq_loss_lasso 
#&gt; method:  weighting 
#&gt; 
#&gt; validation method:  training_test_replication 
#&gt; Cutoff:             Quant_83 
#&gt; iterations:         10 
#&gt; 
#&gt; Average Test Set Outcomes:
#&gt;                               Recommended 0                    Recommended 1
#&gt; Received 0 -15.9204 (SE = 7.3824, n = 40.2) -33.8492 (SE = 7.3124, n = 16.5)
#&gt; Received 1 -20.2731 (SE = 2.4943, n = 62.8)   -6.8326 (SE = 9.5111, n = 5.5)
#&gt; 
#&gt;  0 effect among recommended 0  1 effect among recommended 1 
#&gt;  4.3527 (SE = 7.389, n = 103) 27.0166 (SE = 13.303, n = 22) 
#&gt; 
#&gt; Overall Subgroup Effect 
#&gt;    9.0653 (SE = 5.3511) </div><div class='input'>
<span class='no'>bene.score.test</span> <span class='kw'>&lt;-</span> <span class='no'>subgrp.model</span>$<span class='fu'>predict</span>(<span class='no'>x.test</span>)

<span class='fu'>mean</span>(<span class='no'>y.test</span>[<span class='no'>bene.score.test</span> <span class='kw'>&gt;</span> <span class='fl'>0</span> <span class='kw'>&amp;</span> <span class='no'>trt01.test</span> <span class='kw'>==</span> <span class='fl'>1</span>]) -
       <span class='fu'>mean</span>(<span class='no'>y.test</span>[<span class='no'>bene.score.test</span> <span class='kw'>&gt;</span> <span class='fl'>0</span> <span class='kw'>&amp;</span> <span class='no'>trt01.test</span> <span class='kw'>==</span> <span class='fl'>0</span>])</div><div class='output co'>#&gt; [1] 13.18799</div><div class='input'><span class='fu'>mean</span>(<span class='no'>y.test</span>[<span class='no'>bene.score.test</span> <span class='kw'>&lt;=</span> <span class='fl'>0</span> <span class='kw'>&amp;</span> <span class='no'>trt01.test</span> <span class='kw'>==</span> <span class='fl'>0</span>]) -
       <span class='fu'>mean</span>(<span class='no'>y.test</span>[<span class='no'>bene.score.test</span> <span class='kw'>&lt;=</span> <span class='fl'>0</span> <span class='kw'>&amp;</span> <span class='no'>trt01.test</span> <span class='kw'>==</span> <span class='fl'>1</span>])</div><div class='output co'>#&gt; [1] 15.84766</div><div class='input'>
<span class='fu'>quantile</span>(<span class='no'>valmod</span>$<span class='no'>boot.results</span><span class='kw'>[[</span><span class='fl'>1</span>]][,<span class='fl'>1</span>], <span class='fu'>c</span>(<span class='fl'>0.025</span>, <span class='fl'>0.975</span>))</div><div class='output co'>#&gt;      2.5%     97.5% 
#&gt; -11.53297  27.44914 </div><div class='input'><span class='fu'>quantile</span>(<span class='no'>valmod</span>$<span class='no'>boot.results</span><span class='kw'>[[</span><span class='fl'>1</span>]][,<span class='fl'>2</span>], <span class='fu'>c</span>(<span class='fl'>0.025</span>, <span class='fl'>0.975</span>))</div><div class='output co'>#&gt;     2.5%    97.5% 
#&gt; -9.99472 17.55450 </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jared Huling.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>

